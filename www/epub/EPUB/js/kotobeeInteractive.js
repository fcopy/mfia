function kInteractionStart(){this.log=function(){},kInteractive.setDOMParser(),kInteractive.preRender(),kInteractive.postRender()}var kInteractive={scormWrapper:null,preRender:function(e){for(var t=(new DOMParser,e?e:document),n=t.getElementsByClassName("kInteractive"),a=n.length;a--;){var i=n[a];if(this.hasClass(i,"gallery")){var r=t.createDocumentFragment(),o=kInteractive.readData(i);i.innerHTML="";var s=document.createElement("div");s.className="images "+o.scale;for(var c=0;c<o.imgs.length;c++){var l=document.createElement("div");l.className="imgContainer"+(c?"":" selected");var d="undefined"==typeof isKotobee?o.imgs[c].path:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,o.imgs[c].path);l.setAttribute("style","background-color:"+o.bgColor+";background-image:url('"+d+"')"+(c?"":";display:block")),s.appendChild(l)}r.appendChild(s);var u=document.createElement("a");u.className="next btn ki-btn",1==o.imgs.length&&(u.className+=" disable"),r.appendChild(u);var m=document.createElement("a");m.className="prev btn ki-btn disable",r.appendChild(m),"undefined"==typeof isKotobee&&(u.addEventListener("click",this.actionEvent),m.addEventListener("click",this.actionEvent)),i.appendChild(r)}if(this.hasClass(i,"questions")){var r=t.createDocumentFragment(),p=kInteractive.readData(i);if(i.id||(i.id="ki-qs-"+a+"-"+Math.ceil(1e3*Math.random())),p.options&&p.options.randomize){for(var h,v,f=p.q.length;0!==f;)v=Math.floor(Math.random()*f),f-=1,h=p.q[f],p.q[f]=p.q[v],p.q[v]=h;kInteractive.writeData(i,p)}p.options&&p.options.rtl&&(i.style.direction="rtl"),i.appendChild(r)}if(this.hasClass(i,"image")&&"undefined"==typeof isKotobee&&i.addEventListener("click",this.actionEvent),this.hasClass(i,"link")){var g=kInteractive.readData(i);if("div"==i.nodeName.toLowerCase()){var y=document.createElement("a");y.setAttribute("href","popup"==g.type?"":i.getAttribute("href")),y.setAttribute("target",g.target),y.setAttribute("style",i.getAttribute("style")),y.setAttribute("data-kotobee",i.getAttribute("data-kotobee")),y.className="kInteractive link btn",y.style.opacity=Number(g.transparency)/100,i.parentNode.replaceChild(y,i),i=y}"undefined"==typeof isKotobee&&("popup"==g.type&&i.setAttribute("onclick","return false;"),i.addEventListener("click",this.actionEvent))}if(this.hasClass(i,"container")){var b=kInteractive.readData(i);if(b.path){var d=b.path;"undefined"!=typeof isKotobee&&(d=ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,b.path));var k=i.getAttribute("style");i.setAttribute("style",k+' background-image:url("'+d+'");')}"cScroll"==b.type&&kInteractive.isMobile()&&(i.style.minHeight=i.style.height,i.style.height="auto",i.style.overflowY=null)}}},clearAudioVideo:function(e){for(var t=e?e:document,n=t.getElementsByTagName("audio"),a=n.length;a--;)try{n[a].pause(),n[a].children.length||(n[a].src="")}catch(i){}for(var r=t.getElementsByTagName("video"),a=r.length;a--;)r[a].pause(),r[a].children.length||(r[a].src="")},postRender:function(e){kInteractive.videoIsFullscreen=!1,kInteractive.timestamp=new Date,kInteractive.currentVideo=kInteractive.currentAudio=null,kInteractive.clearAudioVideo(e);for(var t=e?e:document,n=t.getElementsByClassName("kInteractive"),a=n.length;a--;){var i=n[a];if(this.hasClass(i,"questions")){var r=t.createDocumentFragment(),o=kInteractive.readData(i);if(i.innerHTML="",o.title){var s=document.createElement("span");s.innerHTML="<h4>"+kInteractive.escapeHtml(o.title)+"</h4>",r.appendChild(s)}for(var c=0;c<o.q.length;c++){var l=o.q[c],d=document.createElement("div");if(d.className="ques",d.innerHTML="<p><strong>"+(c+1)+". "+kInteractive.escapeHtml(l.q)+"</strong></p>",l.path){var u="undefined"==typeof isKotobee?l.path:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,l.path),m=document.createElement("img");m.src=u,d.appendChild(m)}if("mcq"==l.type||"mmcq"==l.type)for(var p=l.c,h=0;h<p.length;h++){var v="ki-mcq-"+a+"-"+c+"-"+h,f=document.createElement("input");"mmcq"==l.type?(f.name="name",f.type="checkbox"):(f.name="mcq-"+c,f.type="radio"),f.className="ans",f.id=v;var g=document.createElement("label");g.htmlFor=v,g.innerHTML=" "+kInteractive.escapeHtml(p[h].t)+"<br/>",g.className="ki-noHighlight";var y=document.createElement("div");y.className="answer",document[i.id]&&document[i.id].preserve&&document[i.id].q&&document[i.id].q[c]&&(f.checked=document[i.id].q[c][h],o.options&&o.options.highlightCorrect&&o.q[c].c[h].a&&kInteractive.c.addClass(y,"correct")),y.appendChild(f),y.appendChild(g),d.appendChild(y)}else if("tf"==l.type)for(var h=0;2>h;h++){var v="ki-tf-"+a+"-"+c+"-"+h,b=document.createElement("input");b.type="radio",b.name="tf-"+c,b.className="ans",b.id=v;var g=document.createElement("label");g.htmlFor=v,g.innerHTML=l.choice1&&l.choice2?kInteractive.escapeHtml(" "+(0==h?l.choice1:l.choice2)):" "+(0==h?"True":"False"),g.className="ki-noHighlight";var y=document.createElement("div");document[i.id]&&document[i.id].preserve&&document[i.id].q&&document[i.id].q[c]&&(b.checked=document[i.id].q[c][h],o.options&&o.options.highlightCorrect&&(0==h&&o.q[c].a||1==h&&!o.q[c].a)&&kInteractive.c.addClass(y,"correct")),y.appendChild(b),y.appendChild(g),d.appendChild(y)}if(d.appendChild(document.createElement("p")),document[i.id]&&document[i.id].preserve&&document[i.id].q&&document[i.id].q[c]&&o.q[c].exp){var k=d.getElementsByClassName("explanation");if(!k.length){var I=document.createElement("p");I.className="explanation",I.innerHTML=kInteractive.escapeHtml(o.q[c].exp),d.appendChild(I)}}r.appendChild(d)}var C=null;if("none"!=o.action){C=document.createElement("input");var E="ki-"+a+"-btn";C.type="submit",C.value=o.dict?o.dict.submit:"Submit Answers",C.id=E,C.className="btn ki-btn ki-mcq"}var w=null,A=null;if(o.options&&(o.options.clearAnswers&&(w=document.createElement("input"),w.type="submit",w.value=o.dict?o.dict.clear:"Clear Answers",w.className="btn ki-btn ki-questions questions-clear","undefined"==typeof isKotobee&&w.addEventListener("click",this.actionEvent)),o.options.preserveAnswers)){A=document.createElement("div"),A.style.marginTop="5px";var N=document.createElement("input");N.type="checkbox",N.name="preserveAnswers",N.className="ki-btn ki-questions questions-preserve",N.id="ki-"+a+"-preserveAnswersBtn",document[i.id]&&(N.checked=document[i.id].preserve),A.appendChild(N);var g=document.createElement("label");g.htmlFor=N.id,g.innerHTML=" "+(o.dict?o.dict.preserve:"Preserve submitted answers"),g.className="ki-noHighlight",A.appendChild(g),"undefined"==typeof isKotobee&&N.addEventListener("change",this.actionEvent)}"undefined"==typeof isKotobee&&C&&C.addEventListener("click",this.actionEvent),C&&r.appendChild(C),r.appendChild(document.createTextNode(" ")),w&&r.appendChild(w),A&&r.appendChild(A),r.appendChild(document.createElement("p")),i.appendChild(r)}else if(this.hasClass(i,"widget")){var x,r=t.createDocumentFragment(),T=kInteractive.readData(i);x=T.path?"undefined"==typeof isKotobee?T.path:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,T.path):"undefined"==typeof isKotobee?"../js/widgets/":bookPath+"EPUB/js/widgets/";var q=T.name,L=T.src,B=T.width,H=T.height;if("page"==T.mode){if(i.children.length)return;if(!T.interaction){var R=document.createElement("div");R.className="cover",r.appendChild(R)}var S=document.createElement("iframe");S.setAttribute("nwdisable","true"),S.setAttribute("nwfaketop","true"),S.setAttribute("width",i.style.width?i.style.width:B+T.widthUnit),S.setAttribute("height",i.style.height?i.style.height:H+"px"),S.src=x+"/"+q+"/"+L,r.appendChild(S);var O=i.style.width,M=i.style.height;O.indexOf("px")>=0&&(T.widthUnit="px"),O.indexOf("%")>=0&&(T.widthUnit="%");try{T.width=Number(T.widthUnit?O.split(T.widthUnit)[0]:O)}catch(D){T.width=Number(O)}try{T.height=Number(M.split("px")[0])}catch(D){T.height=Number(M)}kInteractive.writeData(i,T)}else{if(i.setAttribute("wdgt-src",L),i.setAttribute("wdgt-name",q),!i.children.length&&!i.innerHTML.trim()){var P=document.createElement("img");P.src=x+"/"+q+"/Icon.png",r.appendChild(P)}"undefined"==typeof isKotobee&&i.addEventListener("click",this.actionEvent)}i.appendChild(r)}else if(this.hasClass(i,"video")){var r=t.createDocumentFragment(),F=kInteractive.readData(i),j="";F.splash&&(j="undefined"==typeof isKotobee?F.splash:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,F.splash));var z=i.style.cssText;-1==z.indexOf("background-image")&&i.setAttribute("style","background-image:url('"+j+"');"+z),i.setAttribute("id","ki-video-"+a),i.innerHTML="";var K=document.createElement("div");K.setAttribute("id","ki-video-"+a+"-container"),K.className="container";var U=document.createElement("a");U.className="playBtn ki-btn","undefined"==typeof isKotobee&&U.addEventListener("click",this.actionEvent),r.appendChild(U),r.appendChild(K),i.appendChild(r)}else if(this.hasClass(i,"audio")){{var r=t.createDocumentFragment();kInteractive.readData(i)}i.setAttribute("id","ki-audio-"+a),i.innerHTML="";var K=document.createElement("div");K.setAttribute("id","ki-audio-"+a+"-container"),K.className="container";var U=document.createElement("a");U.className="playBtn ki-btn","undefined"==typeof isKotobee&&U.addEventListener("click",this.actionEvent),r.appendChild(U),r.appendChild(K),i.appendChild(r)}else if(this.hasClass(i,"threed")){var r=t.createDocumentFragment(),V=kInteractive.readData(i);i.innerHTML="";var W=i.getAttribute("style");if(V.inter.placeholderPath){var Y="undefined"==typeof isKotobee?V.inter.placeholderPath:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,V.inter.placeholderPath);W+="background-image:url('"+Y+"');"}i.setAttribute("style",W);var Q=document.createElement("a");V.inter.includeMsg?(Q.innerHTML=kInteractive.escapeHtml(V.inter.msg),Q.className="msgBtn ki-btn"):Q.className="invisibleBtn ki-btn",r.appendChild(Q),"undefined"==typeof isKotobee&&Q&&Q.addEventListener("click",this.actionEvent),i.appendChild(r)}else this.hasClass(i,"gallery")||this.hasClass(i,"image")}this.firstRun&&(window.addEventListener("resize",function(t){kInteractive.resizeEvent(e,t)}),this.firstRun=!1),kInteractive.resizeEvent(e)},actionEvent:function(e){kInteractive.action(e.target)},action:function(e){function t(){var e="Questions: "+l+". Score: "+u+" questions out of "+p;e+=". Action: "+T,"selfAnswerReport"==T&&(e+=". Details: "+h),kInteractive.tinCan({verb:"solved",activity:e})}function n(e,t){e.style.webkitAnimation=e.style.mozAnimation=e.style.animation=t}function a(e,t){e.style.webkitAnimationDuration=e.style.mozAnimationDuration=e.style.animationDuration=t}function i(e,t){e.style.webkitAnimationIterationCount=e.style.mozAnimationIterationCount=e.style.animationIterationCount=t}function r(e){var t=document.createElement("video");t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("src",e),t.setAttribute("autoplay","true"),t.setAttribute("data-tap-disabled","false"),t.setAttribute("type","video/mp4"),t.setAttribute("webkit-playsinline","true"),t.setAttribute("controls","true"),t.className="ki-noHighlight",t.innerHTML="Your browser doesn't support HTML5 video.",t.oncanplay=function(){kInteractive.currentVideo==s&&($.className="playBtn ki-btn hide",kInteractive.tinCan({verb:"played",activity:"Video: "+e}))},t.addEventListener("webkitfullscreenchange",function(){var e=null!==document.webkitFullscreenElement;kInteractive.videoIsFullscreen=e});var n=s.getElementsByClassName("container")[0];n.setAttribute("data-tap-disabled","true"),n.appendChild(t),t.play()}function o(){function e(e){function n(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(t){return!1}}function a(t){var n=function(e){if(e.lengthComputable){e.loaded/e.total*100}},i=function(){};if(!(t>=dt.objects.length)){var o=dt.objects[t],s="undefined"==typeof isKotobee?o.path:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,o.path),c=new THREE.OBJLoader(d);c.load(s,function(n){ut&&ut.parentNode&&ut.parentNode.removeChild(ut),r.domElement.parentNode||e.appendChild(r.domElement),n.position.set(o.x,o.y,o.z),n.traverse(function(e){if(e instanceof THREE.Mesh){var i=e==n.children[n.children.length-1];if(o.textPath){var r=new THREE.ImageLoader(d),s="undefined"==typeof isKotobee?o.textPath:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,o.textPath);r.load(s,function(r){var o=new THREE.Texture;o.image=r,o.needsUpdate=!0,e.material.map=o,i&&l.add(n),a(++t)},function(){},function(){})}else i&&l.add(n),a(++t)}})},n,i)}}function i(){r.render(l,c);b.getDelta();t=requestAnimFrame(i)}kInteractive.scorm&&setTimeout(function(){var e={};e.id=kInteractive.getScormId("_3D",dt.name?dt.name:"Model"),e.description="Opened 3D model: "+(dt.name?dt.name:"No name"),e.learnerResponses="Viewed",e.type="other",e.timestamp=new Date,kInteractive.scorm.setInteractions([e])},800),t&&cancelAnimationFrame(t);var r;r=n()?new THREE.WebGLRenderer({precision:"highp"}):new THREE.CanvasRenderer;var o=e.offsetWidth,s=e.offsetHeight,c=new THREE.PerspectiveCamera(dt.camera.viewAngle,o/s,dt.camera.near,dt.camera.far),l=new THREE.Scene;null!=dt.scene.bgColor&&r.setClearColor(dt.scene.bgColor,1),l.add(c),c.position.x=dt.camera.x,c.position.y=dt.camera.y,c.position.z=dt.camera.z,r.setSize(o,s),dt.scene.floor&&(floor=new THREE.Mesh(new THREE.PlaneGeometry(500,500,1,1),new THREE.MeshPhongMaterial({color:dt.scene.floorColor?dt.scene.floorColor:10066329})),floor.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2)),floor.position.y=-80,floor.receiveShadow=!0,l.add(floor));var d=new THREE.LoadingManager;d.onProgress=function(){},a(0);var u=new THREE.OrbitControls(c,r.domElement);u.target=new THREE.Vector3(0,0,0);for(var m=0;m<dt.lights.length;m++)if("pointLight"==dt.lights[m].type){var p=new THREE.PointLight(dt.lights[m].color);p.position.set(dt.lights[m].x,dt.lights[m].y,dt.lights[m].z),l.add(p)}else if("directionalLight"==dt.lights[m].type){var h=new THREE.DirectionalLight(dt.lights[m].color,dt.lights[m].intensity);h.position.set(dt.lights[m].x,dt.lights[m].y,dt.lights[m].z),l.add(h)}else if("hemisphereLight"==dt.lights[m].type){var v=new THREE.HemisphereLight(dt.lights[m].sky,dt.lights[m].ground,dt.lights[m].intensity);v.position.set(dt.lights[m].x,dt.lights[m].y,dt.lights[m].z),l.add(v)}else if("spotLight"==dt.lights[m].type){var f=new THREE.SpotLight(dt.lights[m].color,dt.lights[m].intensity,dt.lights[m].distance,dt.lights[m].angle,dt.lights[m].exponent,dt.lights[m].decay);f.position.set(dt.lights[m].x,dt.lights[m].y,dt.lights[m].z),l.add(f)}else if("ambientLight"==dt.lights[m].type){var g=new THREE.AmbientLight(dt.lights[m].color);l.add(g)}else if("areaLight"==dt.lights[m].type){var y=new THREE.AreaLight(dt.lights[m].color,dt.lights[m].intensity);l.add(y)}var b=new THREE.Clock;i()}var t,n=s;if("inPanel"==dt.inter.target){var a={};a["class"]="threed",a.cb=function(t){var n=document.createElement("div");n.className="container",t.appendChild(n),e(n)},a.closed=function(){kInteractive.c.removeClass(s,"running")},kInteractive.openFrame(a)}else e(n)}for(var s=e;!this.hasClass(s,"kInteractive");)if(s=s.parentNode,s==document.body)return;if(this.hasClass(s,"questions")){var c=kInteractive.readData(s),l="Untitled questions",d=s.getElementsByTagName("h4");d.length&&(l=d[0].textContent||d[0].data);var u=0,m=s.getElementsByClassName("ques"),p=m.length,h="";if(this.hasClass(e,"questions-clear")){for(var v=s.getElementsByClassName("ans"),f=0;f<v.length;f++)v[f].checked=!1,kInteractive.c.removeClass(v[f].parentNode,"correct");for(var g=s.getElementsByClassName("explanation"),f=g.length;f--;)g[f].parentNode.removeChild(g[f]);return void(document[s.id]=null)}if(this.hasClass(e,"questions-preserve"))return document[s.id]||(document[s.id]={}),void(document[s.id].preserve=e.checked);for(var y=0,b=0,k=[],f=0;f<m.length;f++){var v=m[f].getElementsByClassName("ans"),I=v.length>0;if(kInteractive.scorm&&c.options&&c.options.answerOnce&&kInteractive.scorm.interactionExists(kInteractive.getScormId(s.id+"-"+(f+1),c.q[f].q))){var C="<p style='text-align:center'>"+(c.dict.alreadySubmitted?c.dict.alreadySubmitted:"This test has already been submitted!")+"</p>";return void kInteractive.alert({content:C})}var E={};k.push(E),E.id=kInteractive.getScormId(s.id+"-"+(f+1),c.q[f].q),E.qid=s.id,E.type=v[0].getAttribute("id").indexOf("ki-tf-")>=0?"true-false":"choice",E.objective=c.options?c.options.objective:null,E.timestamp=kInteractive.timestamp,E.latency=Math.round(((new Date).getTime()-kInteractive.timestamp.getTime())/1e3),E.description=c.q[f].q;for(var w=0;w<v.length;w++)v[w].getAttribute("id").indexOf("ki-tf-")>=0?(0==w&&c.q[f].a?E.correctResponses=c.q[f].choice1:1!=w||c.q[f].a||(E.correctResponses=c.q[f].choice2),v[w].checked?(E.learnerResponses=w?c.q[f].choice2:c.q[f].choice1,0!=w||c.q[f].a?1==w&&c.q[f].a&&(I=!1):I=!1):0==w&&c.q[f].a?I=!1:1!=w||c.q[f].a||(I=!1),c.options&&c.options.highlightCorrect&&(0==w&&c.q[f].a||1==w&&!c.q[f].a)&&kInteractive.c.addClass(v[w].parentNode,"correct")):(c.q[f].c[w].a&&(E.correctResponses=c.q[f].c[w].t),v[w].checked&&(E.learnerResponses=c.q[f].c[w].t),v[w].checked&&!c.q[f].c[w].a?I=!1:!v[w].checked&&c.q[f].c[w].a&&(I=!1),c.options&&c.options.highlightCorrect&&c.q[f].c[w].a&&kInteractive.c.addClass(v[w].parentNode,"correct"));if(E.result=0,null!=c.q[f].weight&&(y+=c.q[f].weight,I&&(b+=c.q[f].weight,E.result=c.q[f].weight)),E.scoreMax=c.options?Number(c.options.totalScore):null,c.q[f].exp){var A=m[f].getElementsByClassName("explanation");if(!A.length){var g=document.createElement("p");g.className="explanation",g.innerHTML=kInteractive.escapeHtml(c.q[f].exp),m[f].appendChild(g)}}var N=c.dict?c.dict.question.replace("[no]",f+1):"Question "+(f+1);I?(h+="<span style='border-bottom: dotted 1px #aaa;' title='"+c.q[f].q+"'>"+N+".</span>  <span style='color:#366c20'>"+c.dict.correct+"</span><br/>",u++):h+="<span style='border-bottom: dotted 1px #aaa;' title='"+c.q[f].q+"'>"+N+".</span>  <span style='color:#7a1818'>"+c.dict.incorrect+"</span><br/>"}for(var f=0;f<k.length;f++)k[f].weighting=Math.round(1e3*c.options.totalScore/y)/1e3;var x,T=c.action;if(c.options.totalScore&&y&&(x=Math.round(10*c.options.totalScore*b/y)/10),"selfAnswer"==T||"selfAnswerReport"==T){var q="";"ar"==c.options.language&&(q=' direction="rtl"');var C="";if(c.dict){if(c.dict.scoreWeight&&null!=x){var L=x>c.options.passScore?c.dict.questionPass:c.dict.questionFail;L&&(L+=". "),C+="<h3"+q+">"+(L?L:"")+c.dict.scoreWeight.replace("[score]",x).replace("[total]",c.options.totalScore)+"</h3>"}C+="<p"+q+">"+c.dict.score.replace("[correct]",u).replace("[total]",p)+"</p>"}else C="You scored "+u+" question(s) out of "+p;"selfAnswerReport"==T&&(C="<p"+q+"><strong>"+C+"</strong></p><p><strong>"+(c.dict?c.dict.details:"Details")+"</strong></p><p class='kbAlertScroll'>"+h+"</p>"),kInteractive.alert({content:C}),t()}else if("email"==T){if("undefined"==typeof isKotobee)return void kInteractive.alert({content:c.dict.cloudOnly,title:c.dict?c.dict.sorry:"Sorry"});if(!config.kotobee.cloudid)return void kInteractive.alert({content:c.dict.cloudOnly,title:c.dict?c.dict.sorry:"Sorry"});var B={};B.ans=new Array;for(var w=0;w<m.length;w++)for(var v=m[w].getElementsByClassName("ans"),f=0;f<v.length;f++)v[f].checked&&B.ans.push({q:w,index:f,label:v[f].nextSibling.textContent||v[f].nextSibling.data});B.title=l;var H={};H.recipient=c.address,H.content=JSON.stringify(B),H.mode=config.kotobee.mode,H.cloudid=config.kotobee.cloudid,H.email=angular.element(document.body).scope().data.user.email;var R=e.value;e.value=c.dict?c.dict.submitting:"Submitting ..",e.setAttribute("disabled","true");var S=new XMLHttpRequest;S.onreadystatechange=function(){try{if(4===S.readyState&&200===S.status){e.value=R,e.removeAttribute("disabled");var t=JSON.parse(S.responseText);kInteractive.alert(t.success?{content:c.dict?c.dict.submitted:"Answers submitted!"}:{content:c.dict?c.dict.errorSubmitting:"An error has occurred while sending answers to the server"})}}catch(n){e.value=R,e.setAttribute("value",e.value),e.removeAttribute("disabled"),kInteractive.alert({content:c.dict?c.dict.errorSubmitting:"An error has occurred while sending answers to the server"})}};var O=config.kotobee.liburl?config.kotobee.liburl:"http://www.kotobee.com/";O+="library/report/questions",S.open("POST",O),S.setRequestHeader("Content-type","application/x-www-form-urlencoded");var M="a=a";for(var D in H){var P=H[D];void 0!=P&&"object"!=typeof P&&("string"==typeof P&&(P=encodeURIComponent(P)),"boolean"==typeof P&&(P=P?1:0),M+="&"+D+"="+P)}S.send(M),t()}document[s.id]||(document[s.id]={}),document[s.id].q=[];for(var F=s.getElementsByClassName("ques"),w=0;w<F.length;w++){document[s.id].q[w]=[];for(var j=F[w].getElementsByClassName("ans"),f=0;f<j.length;f++)document[s.id].q[w][f]=j[f].checked}kInteractive.scorm&&setTimeout(function(){kInteractive.scorm.setInteractions(k)},500)}else if(this.hasClass(s,"widget")){var z,K=kInteractive.readData(s);z=K.path?"undefined"==typeof isKotobee?K.path:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,K.path):"undefined"==typeof isKotobee?"../js/widgets/":bookPath+"EPUB/js/widgets/";var O=z+"/"+K.name+"/"+K.src,U=document.createElement("iframe");U.setAttribute("nwdisable","true"),U.setAttribute("nwfaketop","true"),K.cb=function(e){U.src=O,e.appendChild(U)},K.cb1="yes",K.closed=function(){},kInteractive.openFrame(K),kInteractive.tinCan({verb:"opened",activity:"Widget: "+K.name}),kInteractive.scorm&&setTimeout(function(){var e={};e.id=kInteractive.getScormId("widget",K.name),e.description="Opened popup widget: "+K.name,e.learnerResponses="Opened",e.type="other",e.timestamp=new Date,kInteractive.scorm.setInteractions([e])},800)}else{if(this.hasClass(e,"link")){var H=kInteractive.readData(e);if("popup"==H.type){var C="<p class='kbAlertScroll'>"+H.msg+"</p>";kInteractive.alert({content:C}),kInteractive.scorm&&setTimeout(function(){var e={};e.id=kInteractive.getScormId("popup",H.msg),e.description="Shown popup message: "+H.msg,e.type="other",e.learnerResponses="Shown",e.timestamp=new Date,kInteractive.scorm.setInteractions([e])},800)}return!1}if(this.hasClass(e,"image")){var H=kInteractive.readData(e),V=H.behavior;if("none"==V)return;n(e,"none"),a(e,"none"),i(e,"none"),setTimeout(function(){function t(){var e,t=document.createElement("fakeelement"),n={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(e in n)if(void 0!==t.style[e])return n[e]}function r(){n(e,"none"),a(e,"none"),i(e,"none"),e.removeEventListener(o,r)}"wiggle"==V?(n(e,"wiggle"),a(e,"0.5s"),i(e,"1")):"jump"==V?(n(e,"jump"),a(e,"0.7s"),i(e,"1")):"scale"==V&&(n(e,"scale"),a(e,"0.5s"),i(e,"1"));var o=t();o&&e.addEventListener(o,r)}),kInteractive.tinCan({verb:"clicked",activity:V+"image: "+e.getAttribute("src")})}else if(this.hasClass(s,"gallery")){var W=s.getElementsByClassName("images")[0],u=W.children.length,Y=s.getElementsByClassName("selected")[0],Q=Number(Y.style.left.slice(0,-2)),J=Number(W.style.left.slice(0,-2));if(this.hasClass(e,"next")){var X=Y.nextSibling;if(!X)return;kInteractive.c.removeClass(Y,"selected"),kInteractive.c.addClass(X,"selected"),X.style.left=Q+s.offsetWidth+"px",X.style.display="block",W.style.left=J-s.offsetWidth+"px",X.nextSibling?kInteractive.c.removeClass(e,"disable"):kInteractive.c.addClass(e,"disable"),kInteractive.c.removeClass(s.getElementsByClassName("prev")[0],"disable")}else if(this.hasClass(e,"prev")){var G=Y.previousSibling;if(!G)return;kInteractive.c.removeClass(Y,"selected"),kInteractive.c.addClass(G,"selected"),G.style.left=Q-s.offsetWidth+"px",G.style.display="block",W.style.left=J+s.offsetWidth+"px",G.previousSibling?kInteractive.c.removeClass(e,"disable"):kInteractive.c.addClass(e,"disable"),kInteractive.c.removeClass(s.getElementsByClassName("next")[0],"disable")}}else if(this.hasClass(s,"audio")){kInteractive.stopCurrentMedia();var Z=kInteractive.readData(s);s.style.height=s.offsetHeight+"px";var _=s.getAttribute("id")+"-container",$=s.getElementsByClassName("playBtn")[0];if($.className="playBtn ki-btn hide",kInteractive.scorm){var E={};E.id=kInteractive.getScormId(s.getAttribute("id"),Z.src),E.description="Played audio: "+Z.src,E.type="other",E.learnerResponses="Played",E.objective=Z.options?Z.options.objective:null,E.timestamp=new Date,kInteractive.scorm.setInteractions([E])}var et=Z.src;"file"==Z.type&&(et="undefined"==typeof isKotobee?Z.audio:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,Z.audio));var tt=document.createElement("audio");tt.setAttribute("controls","true"),tt.setAttribute("autoplay","true"),tt.setAttribute("data-tap-disabled","false");var nt=document.createElement("source");nt.src=et,tt.appendChild(nt),tt.appendChild(document.createTextNode("Your browser does not support the audio element")),tt.className="ki-noHighlight",tt.oncanplay=function(){kInteractive.currentAudio==s&&kInteractive.tinCan({verb:"played",activity:"Audio: "+et})};var at=s.getElementsByClassName("container")[0];at.appendChild(tt),tt.play(),kInteractive.currentAudio=s,kInteractive.c.addClass(kInteractive.currentAudio,"playing")}else if(this.hasClass(s,"video")){var it=kInteractive.readData(s),_=s.getAttribute("id")+"-container",$=s.getElementsByClassName("playBtn")[0];if($.className.indexOf("loading")>=0)return;if(kInteractive.stopCurrentMedia(),$.className="playBtn ki-btn loading",kInteractive.scorm){var E={};E.id=kInteractive.getScormId(s.getAttribute("id"),it.src),E.description="Played video: "+it.src,E.type="other",E.learnerResponses="Played",E.objective=it.options?it.options.objective:null,E.timestamp=new Date,kInteractive.scorm.setInteractions([E])}if("file"==it.type){var et="undefined"==typeof isKotobee?it.video:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,it.video);r(et)}else if(it.src.indexOf("youtube.com")>=0||it.src.indexOf("youtu.be/")>=0){var rt;if(it.src.indexOf("youtube.com")>=0){var ot=it.src.split("watch?v=");rt=ot[1]}else{if(!(it.src.indexOf("youtu.be/")>=0))return;var ot=it.src.split("youtu.be/");rt=ot[ot.length-1]}var st={videoId:rt,playerVars:{autoplay:1,rel:"0"},events:{onReady:function(){},onStateChange:function(e){e.data==YT.PlayerState.PLAYING&&kInteractive.tinCan({verb:"played",activity:"Video: "+it.src})}}};if(kInteractive.youTubeStatus)if("loading"==kInteractive.youTubeStatus){if(kInteractive.vQueue)return;kInteractive.vQueue=function(){$.className="playBtn ki-btn hide",new YT.Player(_,st)}}else"ready"==kInteractive.youTubeStatus&&($.className="playBtn ki-btn hide",new YT.Player(_,st));else{window.onYouTubePlayerAPIReady=function(){kInteractive.youTubeStatus="ready",kInteractive.vQueue(),kInteractive.vQueue=null};var ct=document.createElement("script");ct.src="https://www.youtube.com/player_api";var lt=document.getElementsByTagName("script")[0];lt.parentNode.insertBefore(ct,lt),kInteractive.youTubeStatus="loading",kInteractive.vQueue=function(){$.className="playBtn ki-btn hide",new YT.Player(_,st)}}}else r(it.src);kInteractive.currentVideo=s,kInteractive.c.addClass(kInteractive.currentVideo,"playing")}else if(this.hasClass(s,"threed")){var dt=kInteractive.readData(s);"inPanel"==dt.inter.target?kInteractive.c.addClass(s,"running"):s.innerHTML="";var ut=document.createElement("div");if(ut.className="loading",s.appendChild(ut),"undefined"==typeof THREE){var mt,pt=document.getElementsByTagName("head")[0],ht=pt.getElementsByTagName("script");if("undefined"!=typeof isKotobee)mt=bookPath+"EPUB/js/kotobeeInteractive3D.js";else for(var w=0;w<ht.length;w++)if(ht[w].src.indexOf("kotobeeinteractive.js")>=0){mt=ht[w].src.replace("kotobeeinteractive.js","kotobeeinteractive3D.js");break}if(!mt)return;var vt=document.createElement("script");vt.type="text/javascript",vt.src=mt,vt.onload=o,vt.onreadystatechange=function(){"complete"==this.readyState&&o()},pt.appendChild(vt)}else o()}}},openFrame:function(e){function t(){a.style.display="block",a.className="show";var t=window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight,r=window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth;t-=20,r-=20;var o=1;if(e.width&&e.height){var s=r/e.width,c=t/e.height;o=c>s?s:c,o>1&&(o=1)}var d="display:block;";d+=i;var u=e.width||e.height?"-50%,-50%":"0%,0%";d+="-webkit-transform:translate("+u+") scale("+o+");-moz-transform:translate("+u+") scale("+o+");transform:translate("+u+") scale("+o+");",n.style.cssText=d,n.className=l+" ready";var m=n.getElementsByClassName("closeBtn");if(m.length){var p=m[0],h=1/o,v="-50%";kInteractive.hasClass(p,"side")&&(v="0%"),p.style.cssText="-webkit-transform: translate("+v+",0%) scale("+h+");-webkit-transform-origin: 50% 50%;-moz-transform: translate("+v+",0%) scale("+h+");-moz-transform-origin: 50% 50%;transform: translate("+v+",0%) scale("+h+");transform-origin: 50% 50%;"}}var n=document.getElementById("kInteractiveFrame"),a=document.getElementById("kiDarkOverlay"),i="";if(e.dict||(e.dict={}),e.width&&(i+="width:"+e.width+"px;max-width:"+e.width+"px;"),e.height&&(i+="height:"+e.height+"px;max-height:"+e.height+"px;"),n||(a=document.createElement("div"),a.id="kiDarkOverlay",document.body.appendChild(a),a.style.display="none",a.addEventListener("click",kInteractive.closeFrame),n=document.createElement("div"),n.id="kInteractiveFrame"),e.pos||(e.pos="top"),"none"!=e.pos){var r=document.createElement("a"),o="closeBtn";e.pos&&(o+=" "+e.pos),r.className=o;var s=e.dict.close?e.dict.close:"Close";try{s=angular.element(document.body).scope().translit("close")}catch(c){}"side"!=e.pos&&(r.innerHTML=s),r.addEventListener("click",kInteractive.closeFrame),n.appendChild(r)}var l=e["class"]?e["class"]:"";(e.width||e.height)&&(l+=" fixed"),n.style.display="block",n.className=l,document.body.appendChild(n),kInteractive.frameIsOpen=!0,kInteractive.frameOb=e,kInteractive.openFrame.resized=t,window.addEventListener("resize",t),setTimeout(function(){t(),e.cb&&e.cb(n)},100)},closeAlert:function(e){e&&e.stopPropagation();var t=document.getElementById("kiSystemAlertBox"),n=document.getElementById("kiSystemAlertBackdrop");t.parentNode.removeChild(t),n.parentNode.removeChild(n),kInteractive.alertIsOpen=!1},closeFrame:function(){var e=document.getElementById("kInteractiveFrame"),t=document.getElementById("kiDarkOverlay");kInteractive.frameIsOpen=!1,window.removeEventListener("resize",kInteractive.openFrame.resized),kInteractive.openFrame.resized=null,kInteractive.c.removeClass(e,"ready");var n=kInteractive.frameOb,a="";n.width&&(a+="width:"+n.width+"px;max-width:"+n.width+"px;"),n.height&&(a+="height:"+n.height+"px;max-height:"+n.height+"px;"),e.style.cssText=a,t.className="",setTimeout(function(){e.innerHTML="",e.style.display=t.style.display="none",n.closed&&n.closed(),kInteractive.frameOb=null},300)},stopCurrentMedia:function(){if(kInteractive.currentVideo){var e=kInteractive.currentVideo.getAttribute("id")+"-container",t=document.getElementById(e);t.parentNode.removeChild(t);var n=document.createElement("div");n.setAttribute("id",e),n.className="container";var a=kInteractive.currentVideo.getElementsByClassName("playBtn")[0];a.className="playBtn ki-btn",kInteractive.c.removeClass(kInteractive.currentVideo,"playing"),kInteractive.currentVideo.appendChild(n)}if(kInteractive.currentAudio){var e=kInteractive.currentAudio.getAttribute("id")+"-container",t=document.getElementById(e);t.parentNode.removeChild(t);var n=document.createElement("div");n.setAttribute("id",e),n.className="container";var a=kInteractive.currentAudio.getElementsByClassName("playBtn")[0];a.className="playBtn ki-btn",kInteractive.c.removeClass(kInteractive.currentAudio,"playing"),kInteractive.currentAudio.appendChild(n)}},hasClass:function(e,t){if(e&&e.className)for(var n=e.className.trim().split(" "),a=0;a<n.length;a++)if(n[a]&&n[a].trim()==t)return!0
},replaceHTML:function(e,t){var n="string"==typeof e?document.getElementById(e):e,a=n.cloneNode(!1);return a.innerHTML=t,n.parentNode.replaceChild(a,n),a},tinCan:function(e){if("undefined"!=typeof isKotobee)try{angular.element(document.body).scope().tinCanShortcut(e)}catch(t){}},setDOMParser:function(){!function(e){"use strict";var t=e.prototype,n=t.parseFromString;try{if((new e).parseFromString("","text/html"))return}catch(a){}t.parseFromString=function(e,t){if(/^\s*text\/html\s*(?:;|$)/i.test(t)){var a,i=document.implementation.createHTMLDocument(""),r=i.documentElement;return r.innerHTML=e,a=r.firstElementChild,1===r.childElementCount&&"html"===a.localName.toLowerCase()&&i.replaceChild(a,r),i}return n.apply(this,arguments)}}(DOMParser)},readData:function(e){try{var t=e.getAttribute("data-kotobee");return t||(t=e.getAttribute("data")),JSON.parse(decodeURI(kInteractive.XORCipher().decode("kotobee%%author",t)))}catch(n){try{return JSON.parse(kInteractive.XORCipher().decode("kotobee%%author",t))}catch(n){}}},writeData:function(e,t){var n=encodeURI(JSON.stringify(t)),a=e.hasAttribute("data-kotobee")?"data-kotobee":"data";e.setAttribute(a,kInteractive.XORCipher().encode("kotobee%%author",n))},XORCipher:function(){function e(e){var t,n,a,i,r,s,c,l,d,u=0,m="";if(!e)return e;do t=e[u++],n=e[u++],a=e[u++],l=t<<16|n<<8|a,i=l>>18&63,r=l>>12&63,s=l>>6&63,c=63&l,m+=o.charAt(i)+o.charAt(r)+o.charAt(s)+o.charAt(c);while(u<e.length);return d=e.length%3,(d?m.slice(0,d-3):m)+"===".slice(d||3)}function t(e){var t,n,a,i,r,s,c,l,d=0,u=[];if(!e)return e;e+="";do i=o.indexOf(e.charAt(d++)),r=o.indexOf(e.charAt(d++)),s=o.indexOf(e.charAt(d++)),c=o.indexOf(e.charAt(d++)),l=i<<18|r<<12|s<<6|c,t=l>>16&255,n=l>>8&255,a=255&l,u.push(t),64!==s&&(u.push(n),64!==c&&u.push(a));while(d<e.length);return u}function n(e,t){return e.charCodeAt(Math.floor(t%e.length))}function a(e,t){return r(t,function(t,a){return t.charCodeAt(0)^n(e,a)})}function i(e,t){return r(t,function(t,a){return String.fromCharCode(t^n(e,a))}).join("")}function r(e,t){for(var n=[],a=0;a<e.length;a++)n[a]=t(e[a],a);return n}var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s={encode:function(t,n){return n=a(t,n),e(n)},decode:function(e,n){return n=t(n),i(e,n)}};return s},getScormId:function(e,t){return e+"-"+t.replace(/[^a-zA-Z0-9]/g,"-").substr(0,80)},alert:function(e){var t=document.createElement("div");t.setAttribute("id","kiSystemAlertBox");var n=document.createElement("div");n.innerHTML=e.content,n.className="content",t.appendChild(n);var a=document.createElement("div");if(a.className="footer",e.title){var i=document.createElement("div");i.innerHTML=e.title,i.className="header",t.insertBefore(i,t.firstChild)}var r=document.createElement("a"),o="OK";try{o=angular.element(document.body).scope().translit("ok")}catch(s){}r.innerHTML=o,r.className="okBtn",kInteractive.alertIsOpen=!0,r.addEventListener("click",kInteractive.closeAlert),a.appendChild(r),t.appendChild(a);var c=document.createElement("div");c.setAttribute("id","kiSystemAlertBackdrop"),c.addEventListener("click",kInteractive.closeAlert),document.body.appendChild(c),document.body.appendChild(t),r.focus(),setTimeout(function(){t.className="show",c.className="show"},50)},c:{addClass:function(e,t){var n=e.className.trim();if(t instanceof Array){for(var a=!0,i=0;i<t.length;i++)-1==n.indexOf(t[i])&&(a=!1,n+=(""==n?"":" ")+t[i]);if(a)return}else{if(n.indexOf(t)>=0)return;n+=(""==n?"":" ")+t}e.className=n},removeClass:function(e,t){var n=e.className;if(t instanceof Array){for(var a=!0,i=0;i<t.length;i++)n.indexOf(t[i])>=0&&(a=!1,n=n.replace(t[i],""));if(a)return}else{if(-1==n.indexOf(t))return;n=n.replace(t,"")}n=n.trim(),""==n?e.removeAttribute("class"):e.className=n}},escapeHtml:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})},resizeEvent:function(e){for(var t=e?e:document,n=t.getElementsByClassName("kInteractive"),a=n.length;a--;){var i=n[a];if(this.hasClass(i,"widget")){var r=kInteractive.readData(i);if("page"!=r.mode)continue;if("px"!=r.widthUnit)continue;var o=r.width,s=r.height,c=i.parentNode;if(!c)continue;if(o>c.offsetWidth){var l=c.offsetWidth/o,d=i.children.length-1;i.children[d].style.transform=i.children[d].style.webkitTransform=i.children[d].style.mozTransform="scale("+l+")",i.children[d].style.transformOrigin=i.children[d].style.webkitTransformOrigin=i.children[d].style.mozTransformOrigin="0 0",i.style.maxWidth=i.style.width,i.style.height=Math.round(s*l)+"px"}else{for(var d=0;d<i.children.length;d++)i.children[d].style.transform=i.children[d].style.webkitTransform=i.children[d].style.mozTransform=i.children[d].style.transformOrigin=i.children[d].style.webkitTransformOrigin=i.children[d].style.mozTransformOrigin=null;i.style.maxWidth=null,i.style.height=s+"px"}}}},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},closeFullscreenVideo:function(){kInteractive.currentVideo&&(kInteractive.currentVideo.webkitExitFullscreen?kInteractive.currentVideo.webkitExitFullscreen():kInteractive.currentVideo.mozCancelFullScreen&&kInteractive.currentVideo.mozCancelFullScreen(),kInteractive.videoIsFullscreen=!1)},vQueue:[],youTubeReady:!1,firstRun:!0};if("undefined"==typeof isKotobee)try{document.addEventListener("DOMContentLoaded",kInteractionStart,!1)}catch(er){window.addEventListener("load",kInteractionStart,!1)}